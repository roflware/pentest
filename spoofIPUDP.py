#!/usr/bin/env python
 
import socket,sys
from impacket import ImpactDecoder, ImpactPacket
 
src = sys.argv[1]
dst = sys.argv[2]
sport = 54600
dport = 54601
 
#Create a new IP packet and set its source and destination addresses
 
ip = ImpactPacket.IP()
ip.set_ip_src(src)
ip.set_ip_dst(dst)
 
#Create a new ICMP packet
 
udp = ImpactPacket.UDP()

udp.set_uh_sport(sport)
udp.set_uh_dport(dport)

#inlude a small payload inside the ICMP packet
#and have the ip packet contain the ICMP packet
#udp.contains(ImpactPacket.Data("a"*100))
udp.contains(ImpactPacket.Data("\x41\x41\x41\x41"))
ip.contains(udp)
 
s = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_UDP)
s.setsockopt(socket.IPPROTO_IP, socket.IP_HDRINCL, 1)
s.sendto(ip.get_packet(), (dst, 0))
